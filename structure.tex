%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Wilson Resume/CV
% Structure Specification File
% Version 1.0 (22/1/2015)
%
% This file has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\usepackage[a4paper, hmargin=25mm, vmargin=30mm, top=20mm]{geometry} % Use A4 paper and set margins

\usepackage{fancyhdr} % Customize the header and footer

\usepackage{lastpage} % Required for calculating the number of pages in the document
\usepackage{xcolor}
\usepackage[unicode=true, colorlinks=true, citecolor={blue!80!black}, urlcolor={blue!20!black}, linkcolor = {blue!20!black}]{hyperref}
\setcounter{secnumdepth}{0} % Suppress section numbering

%\usepackage[proportional,scaled=1.064]{erewhon} % Use the Erewhon font
%\usepackage[erewhon,vvarbb,bigdelims]{newtxmath} % Use the Erewhon font
\usepackage[utf8]{inputenc} % Required for inputting international characters
\usepackage[T1]{fontenc} % Output font encoding for international characters

\usepackage{fontspec} % Required for specification of custom fonts
\setmainfont[
BoldFont = Erewhon-Bold,
ItalicFont = Erewhon-Italic,
BoldItalicFont = Erewhon-BoldItalic,
SmallCapsFeatures = {Letters = SmallCaps}
]{Erewhon-Regular}

\usepackage{color} % Required for custom colors
\definecolor{slateblue}{rgb}{0.17,0.22,0.34}

\usepackage{sectsty} % Allows customization of titles
\sectionfont{\color{slateblue}} % Color section titles

\usepackage[backend=biber,
           bibstyle=numeric,
           sorting=ymdnt,
           sortcites=true,
           natbib=true,
           defernumbers=true,
           maxbibnames=99,
           giveninits=true,
           uniquename=false]{biblatex} % Bibliography handling

\fancypagestyle{plain}{\fancyhf{}\cfoot{\thepage\ of \pageref{LastPage}}} % Define a custom page style
\pagestyle{plain} % Use the custom page style through the document
\renewcommand{\headrulewidth}{0pt} % Disable the default header rule
\renewcommand{\footrulewidth}{0pt} % Disable the default footer rule

\setlength\parindent{0pt} % Stop paragraph indentation

% Non-indenting itemize
\newenvironment{itemize-noindent}
{\setlength{\leftmargini}{0em}\begin{itemize}}
{\end{itemize}}

% Text width for tabbing environments
\newlength{\smallertextwidth}
\setlength{\smallertextwidth}{\textwidth}
\addtolength{\smallertextwidth}{-2cm}

\newcommand{\sqbullet}{~\vrule height 1ex width .8ex depth -.2ex} % Custom square bullet point definition

%----------------------------------------------------------------------------------------
%	MAIN HEADER COMMAND
%----------------------------------------------------------------------------------------

\renewcommand{\title}[1]{
{\huge{\color{slateblue}\textbf{#1}}}\\ % Header section name and color
\rule{\textwidth}{0.5mm}\\ % Rule under the header
}

%----------------------------------------------------------------------------------------
%	JOB COMMAND
%----------------------------------------------------------------------------------------

\newcommand{\job}[6]{
\begin{tabbing}
\hspace{2cm} \= \kill
\textbf{#1} \> \href{#4}{#3} \\
\textbf{#2} \>\+ \textit{#5} \\
\begin{minipage}{\smallertextwidth}
\vspace{2mm}
#6
\end{minipage}
\end{tabbing}
\vspace{2mm}
}

\newcommand{\stay}[6]{
\begin{tabbing}
\hspace{2cm} \= \hspace{2cm}  \= \kill
\>{#1} \> \href{#4}{#3} \\
\>{#2} \>\+ \textit{#5} \\
\> \begin{minipage}{\smallertextwidth}
\vspace{2mm}
#6
\end{minipage}
\end{tabbing}
\vspace{2mm}
}

%----------------------------------------------------------------------------------------
%	SKILL GROUP COMMAND
%----------------------------------------------------------------------------------------

\newcommand{\skillgroup}[2]{
\begin{tabbing}
\hspace{5mm} \= \kill
\sqbullet \>\+ \textbf{#1} \\
\begin{minipage}{\smallertextwidth}
\vspace{2mm}
#2
\end{minipage}
\end{tabbing}
}

%----------------------------------------------------------------------------------------
%	INTERESTS GROUP COMMAND
%-----------------------------------------------------------------------------------------

\newcommand{\interestsgroup}[1]{
\begin{tabbing}
\hspace{5mm} \= \kill
#1
\end{tabbing}
\vspace{-10mm}
}

\newcommand{\interest}[1]{\sqbullet \> \textbf{#1}\\[3pt]} % Define a custom command for individual interests

%----------------------------------------------------------------------------------------
%	TABBED BLOCK COMMAND
%----------------------------------------------------------------------------------------

\newcommand{\tabbedblock}[1]{
\begin{tabbing}
\hspace{2cm} \= \hspace{4cm} \= \kill
#1
\end{tabbing}
}

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY CONFIGURATION. Taken from https://www.hansenlab.org/cv_bibliography_tex
%----------------------------------------------------------------------------------------

\renewcommand*{\mkbibnamegiven}[1]{
\ifitemannotation{highlight}
{\textbf{#1}}
{#1}}
\renewcommand*{\mkbibnamefamily}[1]{%
  \begingroup
    \ifitemannotation{highlight}{\def\doformat{\textbf}}{\def\doformat{}}%
    \doformat{#1}%
    \ifitemannotation{first}{\textsuperscript{*}}{}%
    \ifitemannotation{corresponding}{$^\dagger$}{}%
  \endgroup
}%%

% % Sort backwards
% \AtDataInput{%
%   \xifinlistcs{\thefield{entrykey}}{entrylist:\therefsection}{}{%
%     \listcsxadd{entrylist:\therefsection}{\thefield{entrykey}}%
%     \csnumgdef{entrycount:\therefsection}{%
%       \csuse{entrycount:\therefsection}+1}}}

      % Count total number of entries in each refsection

% Each refsection has its own counter prefix
\newcommand{\refsectionletter}[1]{%
    \ifcase#1\relax%
    \or P%
    \or C%
    \or O%
    \or F%
    \else A%
    \fi%
}
\AtDataInput{%
  \csnumgdef{entrycount:\therefsection}{%
    \csuse{entrycount:\therefsection}+1}}
% Print the labelnumber as the total number of entries in the
% current refsection, minus the actual labelnumber, plus one
\DeclareFieldFormat{labelnumber}{\refsectionletter{\therefsection}\mkbibdesc{#1}}    
\newrobustcmd*{\mkbibdesc}[1]{%
  \number\numexpr\csuse{entrycount:\therefsection}+1-#1\relax}


% Sort by year, month, day, title
\DeclareSortingScheme{ymdnt}{
  \sort{
    \field{presort}
  }
  \sort[final]{
    \field{sortkey}
  }
  \sort[direction=descending]{
    \field[strside=left,strwidth=4]{sortyear}
    \field[strside=left,strwidth=4]{year}
    \literal{9999}
  }
  \sort[direction=descending]{
    \field{month}
    \literal{9999}
  }
  \sort{
    \field{sortname}
    \field{author}
    \field{editor}
    \field{translator}
    \field{sorttitle}
    \field{title}
  }
  \sort{
    \field{sorttitle}
    \field{title}
  }
}

% Citation formats custom (https://tex.stackexchange.com/questions/12806/guidelines-for-customizing-biblatex-styles)
\DeclareFieldFormat
  [article]
  {title}{\textit{#1\isdot}}

\DeclareFieldFormat
  [unpublished]
  {note}{\textit{#1\isdot}}

\DeclareFieldFormat
  [unpublished]
  {date}{\textbf{#1\isdot}}

\renewbibmacro*{journal+issuetitle}{%
  \iffieldundef{journaltitle}
    {}
    {\printtext[journaltitle]{%
       \printfield[titlecase]{journaltitle}}}%
  \setunit*{\addspace}%
  \printfield{volume}%
  \setunit*{\addcomma\space}%
  \printfield{pages}%
  \setunit*{\addspace}%
  \printtext{(}%
  \printfield{year}%
  \printtext{)}%
}

\renewbibmacro*{doi+eprint+url}{%
  \iffieldundef{doi}
    {}
    {\printfield{doi}}%
}

\DeclareFieldFormat{journallink}{%
  \iffieldundef{doi}
    {#1}
    {\href{https://doi.org/\thefield{doi}}{#1}}%
}

\DeclareFieldFormat{pages}{#1}

\DeclareBibliographyDriver{article}{%
  \printnames{author}%
  \setunit{\labelnamepunct}\newblock
  \printfield{title}%
  \setunit{\addcomma\space}%
  \printtext[journallink]{%
    \iffieldundef{shortjournal}
      {\printfield{journaltitle}}
      {\printfield{shortjournal}}%
    \setunit*{\addcomma\space}%
    \printfield{volume}%
    \setunit*{\addcomma\space}%
    \printfield{pages}%
    \setunit*{\addspace}%
    \printtext{(}%
    \printfield{year}%
    \printtext{)}%
  }%
  \iffieldundef{citations}
    {}
    {\addspace\printtext{Citations: }\printfield{citations}}%
  \finentry
}

\DeclareFieldFormat{noteyearlink}{%
  \iffieldundef{doi}
    {#1}
    {\href{https://doi.org/\thefield{doi}}{#1}}%
}

\DeclareBibliographyDriver{misc}{%
  \printnames{author}%
  \setunit{\labelnamepunct}\newblock
  \printfield{title}%
  \setunit{\addcomma\space}%
  \printtext[noteyearlink]{%
    \printfield{note}%
    \setunit*{\addspace}%
    \printtext{(}%
    \printfield{year}%
    \printtext{)}%
  }%
  \finentry
}


\DeclareBibliographyDriver{unpublished}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \newunit\newblock
  \usebibmacro{location+date}%
  \usebibmacro{author}%
  \setunit{\printdelim{nametitledelim}}\newblock
  \usebibmacro{title}%
  \newunit
  \printlist{language}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \printfield{howpublished}%
  \newunit\newblock
  \usebibmacro{event+venue+date}%
  \newunit\newblock
  \printfield{type}%
  \newunit\newblock
  \printfield{note}%
  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
  \usebibmacro{finentry}}

  % Funding

\DeclareBibliographyDriver{funding}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{title+institution}%
  \usebibmacro{agency+code+period}
  \newunit\newblock
  \usebibmacro{value_macro}
  \newunit\newblock
  \usebibmacro{pi_macro}
  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
  \usebibmacro{finentry}}

  \newbibmacro*{title+institution}{
    \printfield{title}
    \printtext{at}
    \printfield{institution}
  }
  \newbibmacro*{agency+code+period}{
    {\printtext[parens]{
        \printfield{agency}
        \setunit*{\addcomma\space}
        \printfield{code}
        \printtext{for the period}
        \printfield{period}
    }}
  \newunit}

\newbibmacro*{value_macro}{
    \newunit
    \ifboolexpr{
        test {\iffieldundef{value}}
    }
    {}
    {
    \printtext{Ammount:}
    \printfield{value}
    }
  }

\newbibmacro*{pi_macro}{
    \newunit
    \ifboolexpr{
        test {\iffieldundef{pis}} 
    }
    {}
    {
    \printtext{Principal investigators:}
    \printfield{pis}
    }
    }

% Awards
\DeclareFieldFormat
  [award]
  {worktitle}{\textit{#1\isdot}}
\DeclareBibliographyDriver{award}{%
    \usebibmacro{bibindex}%
    \usebibmacro{begentry}%
    \printfield{title}%
    \newunit\newblock
    \usebibmacro{institution+year}
    \newunit\newblock
    \usebibmacro{work_macro}
    \newunit\newblock
    \usebibmacro{period_macro}
    \newunit\newblock
    \usebibmacro{note_macro}
    \newunit\newblock
    \iftoggle{bbx:related}
      {\usebibmacro{related:init}%
       \usebibmacro{related}}
      {}%
    \usebibmacro{finentry}}
  
\newbibmacro*{institution+year}{
    \printfield{institution}
    \setunit*{\addcomma\space}
    \printfield{year}
    }

\newbibmacro*{period_macro}{
    \ifboolexpr{
        test {\iffieldundef{period}}
    }
    {}
    {
    \printtext{Received during the period}
    \printfield{period}
    }
    }

\newbibmacro*{note_macro}{
    \ifboolexpr{
        test {\iffieldundef{note}}
    }
    {}
    {
    \printfield{note}
    }
    }

\newbibmacro*{work_macro}{
    \ifboolexpr{
        test {\iffieldundef{worktitle}}
    }
    {}
    {
    \printtext{For the work entitled}
    \printfield{worktitle}
    }
    }